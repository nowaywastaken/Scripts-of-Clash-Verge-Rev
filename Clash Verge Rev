function isDailyNode(name) {
    const include = /(ç¾Žå›½|æ—¥æœ¬|æ–°åŠ å¡|US|JP|Japan|SG|Singapore)/i.test(name);
    const exclude = /(é¦™æ¸¯|å°æ¹¾|HK|TW|HongKong|Taiwan)/i.test(name);
    return include && !exclude;
}

function isUSNode(name) {
    const include = /(ç¾Žå›½|US|America|States|æ–°åŠ å¡|SG|Singapore)/i.test(name);
    const exclude = /(é¦™æ¸¯|å°æ¹¾|HK|TW|HongKong|Taiwan)/i.test(name);
    return include && !exclude;
}

function isStreamNode(name) {
    return /(æ–°åŠ å¡|SG|Singapore)/i.test(name);
}

function isOvercooked(name) {
  return /(é¦™æ¸¯|HK|HongKong)/i.test(name);
}

function main(config) {

  const myRules = [
    // --- æµåª’ä½“é˜Ÿ (æ–°åŠ å¡) ---
    "DOMAIN-SUFFIX,netflix.com,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    "DOMAIN-SUFFIX,netflix.net,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    "DOMAIN-SUFFIX,nflximg.net,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    "DOMAIN-SUFFIX,nflxvideo.net,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    "DOMAIN-SUFFIX,nflxso.net,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    "DOMAIN-SUFFIX,nflxext.com,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    "DOMAIN-KEYWORD,netflix,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    "DOMAIN-SUFFIX,fast.com,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    
    "DOMAIN-SUFFIX,tiktok.com,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    "DOMAIN-SUFFIX,tiktokv.com,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    "DOMAIN-SUFFIX,tiktokcdn.com,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    "DOMAIN-KEYWORD,tiktok,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    "DOMAIN-SUFFIX,musical.ly,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    "DOMAIN-SUFFIX,muscdn.com,ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    
    // --- ðŸŒ è°·æ­Œä¸“çº¿ (ç¾Ž/æ–°) ---
    "DOMAIN-KEYWORD,google,ðŸŒ è°·æ­Œä¸“çº¿",
    "DOMAIN-SUFFIX,googleapis.com,ðŸŒ è°·æ­Œä¸“çº¿",
    "DOMAIN-SUFFIX,gstatic.com,ðŸŒ è°·æ­Œä¸“çº¿",
    "DOMAIN-SUFFIX,youtu.be,ðŸŒ è°·æ­Œä¸“çº¿",
    "DOMAIN-SUFFIX,ytimg.com,ðŸŒ è°·æ­Œä¸“çº¿",

    // --- ðŸš€ æ—¥å¸¸ä¸»åŠ› (ç¾Ž/æ—¥/æ–° æ··åˆ) ---
    "DOMAIN-SUFFIX,apple-relay.akamaized.net,ðŸš€ æ—¥å¸¸ä¸»åŠ›",
    "DOMAIN-SUFFIX,apple-relay.apple.com,ðŸš€ æ—¥å¸¸ä¸»åŠ›",
    "DOMAIN-SUFFIX,apple-relay.cloudflare.com,ðŸš€ æ—¥å¸¸ä¸»åŠ›",
    "DOMAIN-SUFFIX,apple-relay.fastly-edge.com,ðŸš€ æ—¥å¸¸ä¸»åŠ›",
    "DOMAIN-SUFFIX,apple-relay.mask.apple-dns.net,ðŸš€ æ—¥å¸¸ä¸»åŠ›",
    "DOMAIN-SUFFIX,apple.com,ðŸš€ æ—¥å¸¸ä¸»åŠ›",
    "DOMAIN-SUFFIX,v2ex.com,ðŸš€ æ—¥å¸¸ä¸»åŠ›",

    "DOMAIN-SUFFIX,atlassian.com,ðŸš€ æ—¥å¸¸ä¸»åŠ›",

    "DOMAIN-SUFFIX,line.naver.jp,ðŸš€ æ—¥å¸¸ä¸»åŠ›",
    "DOMAIN-SUFFIX,line.me,ðŸš€ æ—¥å¸¸ä¸»åŠ›",
    "DOMAIN-SUFFIX,line-apps.com,ðŸš€ æ—¥å¸¸ä¸»åŠ›",
    "DOMAIN-SUFFIX,line-cdn.net,ðŸš€ æ—¥å¸¸ä¸»åŠ›",
    "DOMAIN-SUFFIX,line-scdn.net,ðŸš€ æ—¥å¸¸ä¸»åŠ›",

    "DOMAIN-SUFFIX,steampowered.com,ðŸ‡­ðŸ‡° é¦™æ¸¯",

    "DOMAIN-SUFFIX,gameanalytics.com,ðŸ‡­ðŸ‡° é¦™æ¸¯",
    "DOMAIN-SUFFIX,t17service.com,ðŸ‡­ðŸ‡° é¦™æ¸¯",
    "DOMAIN-SUFFIX,964nzttlu1.execute-api.eu-west-1.amazonaws.com,ðŸ‡­ðŸ‡° é¦™æ¸¯",
    "IP-CIDR,59.37.139.7/32,ðŸ‡­ðŸ‡° é¦™æ¸¯,no-resolve",

    "DOMAIN-SUFFIX,luyuyun.com,DIRECT",
    "IP-CIDR,172.16.0.0/12,DIRECT,no-resolve",
    "IP-CIDR,192.168.0.0/16,DIRECT,no-resolve",
    "IP-CIDR,127.0.0.0/8,DIRECT,no-resolve",
    "IP-CIDR,10.0.0.0/8,DIRECT,no-resolve", 
];

  const proxies = config.proxies || [];
  
  const dailyProxies = proxies.filter(p => isDailyNode(p.name)).map(p => p.name);
  const usProxies = proxies.filter(p => isUSNode(p.name)).map(p => p.name); 
  const streamProxies = proxies.filter(p => isStreamNode(p.name)).map(p => p.name);
  const overcookedProxies = proxies.filter(p => isOvercooked(p.name)).map(p => p.name);

  const groupDaily = {
    name: "ðŸš€ æ—¥å¸¸ä¸»åŠ›",
    type: "url-test",
    url: "http://www.gstatic.com/generate_204",
    interval: 300,
    tolerance: 50,
    proxies: dailyProxies.length > 0 ? dailyProxies : ["DIRECT"]
  };

  const groupGoogle = {
    name: "ðŸŒ è°·æ­Œä¸“çº¿",
    type: "url-test",
    url: "http://www.gstatic.com/generate_204",
    interval: 300,
    tolerance: 50,
    proxies: usProxies.length > 0 ? usProxies : ["DIRECT"]
  };

  const groupStream = {
    name: "ðŸ‡¸ðŸ‡¬ æµåª’ä½“",
    type: "url-test",
    url: "http://www.gstatic.com/generate_204",
    interval: 300,
    tolerance: 50,
    proxies: streamProxies.length > 0 ? streamProxies : ["DIRECT"]
  };

  const groupOvercooked = {
    name: "ðŸ‡­ðŸ‡° é¦™æ¸¯",
    type: "url-test",
    url: "http://www.gstatic.com/generate_204",
    interval: 300,
    tolerance: 50,
    proxies: overcookedProxies.length > 0 ? overcookedProxies : ["DIRECT"]
  };

  if (!config["proxy-groups"]) config["proxy-groups"] = [];
  config["proxy-groups"].unshift(groupDaily, groupGoogle, groupStream, groupOvercooked);

  config.rules = myRules.concat(config.rules || []);

  return config;
}
